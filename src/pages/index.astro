---
import BaseLayout from "../layouts/BaseLayout.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import Footerd from "../components/Footerd.astro";
import Navd from "../components/Navd.astro";


const supabaseUrl = "https://invkqrczmevlsbzdnlja.supabase.co";
const supabaseKey = "sb_publishable_c5vkkFb_XH0fhn9JCO6Dtg_wQ9vMSiY";

type Lokale = {
  id: number;
  title: string;
  city: string;
  image_url: string;
  price_weekday: number | null;
};

let featured: Lokale[] = [];

try {

  const titles = [
    "DET LILLE FÆLLESHUS",
    "SØPAVILLONEN",
    "ELMEGÅRDEN",
  ];

  const titleFilter = titles.map((t) => `"${t}"`).join(",");

  const res = await fetch(
    `${supabaseUrl}/rest/v1/Lokaler?select=id,title,city,image_url,price_weekday&title=in.(${encodeURIComponent(titleFilter)})`,
    {
      headers: {
        apikey: supabaseKey,
        Authorization: `Bearer ${supabaseKey}`,
      },
    }
  );

  if (!res.ok) {
    console.error("Supabase index fetch error", res.status, await res.text());
  } else {
    featured = await res.json();
  }
} catch (err) {
  console.error("Supabase index fetch failed", err);
}

function formatPrice(price: number | null | undefined) {
  if (price == null) return "";
  return new Intl.NumberFormat("da-DK").format(price);
}


const order = ["DET LILLE FÆLLESHUS", "SØPAVILLONEN", "ELMEGÅRDEN"];
featured.sort((a, b) => order.indexOf(a.title) - order.indexOf(b.title));
---

<BaseLayout title="Vores Bolig - Forside" description="Jeres boligselskab, der administrerer og udlejer almene boliger og lokaler.">
  <section class="hero">
    <div class="hero__nav">
      <Navd color="#FBFBFB" logo="/logo_hvid.webp"/>
      <Nav color="#FBFBFB" logo="/logo_hvid.webp" />
    </div>

    <img src="/display.webp" alt="Bygning" class="hero__img" />
    <div class="hero__overlay"></div>

    <div class="hero__content">
      <div class="hero__top">
        <div class="hero__meta">/VB</div>
        <div class="hero__line"></div>
      </div>

      <div class="hero__deskMeta">
  <div class="hero__deskLeft">Organisationen<br />for borgerne</div>

  <div class="hero__deskCenter">
    <div class="hero__deskVB">/VB</div>
    <p class="hero__deskText">
      Jeres boligselskab, der<br />
      der administrerer og udlejer almene<br />
      boliger og lokaler til beboere.
    </p>
  </div>

  <a href="/kontakt" class="hero__deskKontakt">Kontakt →</a>
</div>

      <p class="hero__text">
        Jeres boligselskab, der administrerer og udlejer almene boliger og lokaler til beboere.
      </p>

      <a href="/kontakt" class="hero__link">Kontakt →</a>

      <h1 class="hero__title">
        HJEM<br />
        SKABER<br />
        NÆRHED
      </h1>
      <h1 class="hero__titleDesktop" aria-label="HJEM SKABER NÆRHED">
      <span class="t1">HJEM</span>
      <span class="t2">SKABER</span>
      <span class="t3">NÆRHED</span>
      </h1>
    </div>
  </section>

  <section class="sek_to">
    <p  class="sek_to__text sek_to__text--mobile">HJEMLIGHED FORMER HELE VORES ARBEJDE, FRA ANKOMSTENS RO TIL HVERDAGENS RYTME.</p>
    <p class="sek_to__text sek_to__text--desktop">
  HJEMLIGHED FORMER HELE<br />
  VORES ARBEJDE, FRA ANKOMSTENS<br />
  RO TIL HVERDAGENS RYTME.
</p>
    <img src="bolig.webp" alt="bolig billeder" />
  </section>

  <section class="organisationen">
    <div class="organisationen__content">
      <div class="organisationen__label">Organisationen</div>
      <div class="organisationen__tag">/OM OS</div>
      <p class="organisationen__text">
       Vores Bolig er et alment boligselskab i Frederikssund, som administrerer og udlejer boliger til mennesker i alle livssituationer. Som en non-profit organisation arbejder de efter et klart formål: at skabe gode, trygge og økonomisk tilgængelige boliger for deres beboere.
      </p>

      <p class="organisationen__text">
        Boligselskabet sikrer en stabil drift af deres afdelinger, vedligeholder bygningerne og sørger for, at både nye og eksisterende beboere møder en professionel og nærværende boligadministration.
      </p>

      <div class="organisationen__cta">
        <h2>UDLEJ<br />LOKALER</h2>
        <a href="/lokaler">ALLE LOKALER →</a>
      </div>
    </div>

    <div class="organisationen__divider"></div>
  </section>

  <section class="lokaleCards">
    {featured.map((l) => (
      <article class="lokaleCard">
        <a class="productLink" href={`/lokale/${l.id}`}>
          <img class="lokaleImg" src={l.image_url} alt={l.title} />
        </a>

        <div class="lokaleMeta">
          <div class="lokaleLeft">
            <div class="lokaleName">{l.title}</div>
            <div class="lokaleCity">{l.city?.toUpperCase()}</div>
          </div>

          <div class="lokalePrice">
            {l.price_weekday ? `FRA ${formatPrice(l.price_weekday)} KR.` : ""}
          </div>
        </div>
      </article>
    ))}
  </section>

  <Footer class="FooterMob" />
  <Footerd class="FooterDesk" />
</BaseLayout>

<style>
  
  .hero {
    position: relative;
    height: 844px;
    overflow: hidden;
    color: #fbfbfb;
  }

  .hero__nav {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 3;
  }

  .hero__img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .productLink {
    display: block;
    color: inherit;
    text-decoration: none;
  }

  .hero__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    z-index: 1;
  }

  .hero__content {
    position: relative;
    z-index: 2;
    padding-inline: 8px;
    padding-top: 8.5rem;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .hero__top {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .hero__meta {
    font-size: 1rem;
    font-family: "Whyte Mono Inktrap";
    opacity: 0.7;
    padding-top: 10px;
    white-space: nowrap;
    margin-top: 195px;
  }

  .hero__line {
    flex: 1;
    height: 1px;
    background: #fbfbfb;
    margin-inline: -50px;
    margin-top: 160px;
  }

  .hero__text {
    font-family: "Whyte";
    margin-top: -1.4rem;
    font-size: 1.4rem;
    font-weight: 300;
    line-height: 1.4;
    max-width: 90%;
    text-indent: calc(5.5rem + 12px);
  }

  .hero__link {
    margin-top: 1.5rem;
    font-family: "Whyte";
    font-weight: 300;
    font-size: 1rem;
    margin-top: 60px;
    padding-left: 100px;
    color: #fbfbfb;
    text-decoration: none;
  }

  .hero__title {
    margin-top: auto;
    font-family: "Whyte Inktrap";
    font-size: 4.8rem;
    line-height: 0.9;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: -0.04rem;
    margin-bottom: 0rem;
  }

  .hero > :global(nav) {
    position: relative;
    z-index: 1000;
  }

  .sek_to {
    height: 600px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: #fbfbfb;
    border-bottom: 1px solid rgba(0, 0, 0, 0.15);
  }

  .sek_to p {
    font-family: "Whyte Inktrap", sans-serif;
    font-size: 38px;
    line-height: 1.05;
    margin: 0;
    text-transform: uppercase;
  }

  .sek_to img {
    width: 185px;
    height: 247px;
    object-fit: cover;
    display: block;
    margin-bottom: 35px;
    margin-top: 35px;
  }

  .organisationen {
    height: 540px;
    padding: 16px 8px 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: #fbfbfb;
  }

  .organisationen__content {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .organisationen__label {
    font-family: "Whyte";
    font-size: 16px;
    color: #040404;
  }

  .organisationen__text {
    font-family: "Whyte";
    font-size: 16px;
    line-height: 1.2;
    color: #040404;
    margin: 0;
  }

  .organisationen__cta {
    margin-top: 105px;
  }

  .organisationen__cta h2 {
    font-family: "Whyte Inktrap";
    font-size: 64px;
    font-weight: 400;
    line-height: 0.95;
    color: #040404;
    margin: 0;
    text-transform: uppercase;
  }

  .organisationen__cta a {
    display: inline-block;
    margin-top: 8px;
    font-family: "Whyte";
    font-size: 12px;
    color: #040404;
    text-decoration: underline;
  }

  .organisationen__divider {
    height: 1px;
    background: rgba(0, 0, 0, 0.15);
  }

  .lokaleCards {
    height: 1268px;
    margin-top: 20px;
    padding: 0.5rem;
    background: #fbfbfb;
    border-bottom: 1px solid rgba(4, 4, 4, 0.15);
  }

  .lokaleCard {
    margin: 0 0 1.5rem 0;
  }

  .lokaleImg {
    width: 100%;
    height: 335px;
    object-fit: cover;
    display: block;
    background: #fbfbfb;
  }

  .lokaleMeta {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-top: 0.5rem;
    font-family: "Whyte Mono Inktrap";
    font-size: 12px;
    color: #040404;
    letter-spacing: 0.02em;
  }

  .lokaleLeft {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .lokaleCity {
    opacity: 0.5;
  }

:global(.footerDesktop) {
  display: none;
}

:global(.footerMobile) {
  display: block;
}
:global(.navd) { display: none !important; }
:global(.nav)  { display: flex !important; }

 .heroDeskOrg {
    display: none;
  }
  .hero__titleDesktop {
  display: none;
}
.hero__deskMeta {
  display: none;
}
.sek_to__text--desktop { display: none; }
.sek_to__text--mobile { display: block; }

.organisationen__tag { display: none; }

  @media (min-width: 750px) {
  
  :global(.footerDesktop) {
    display: block;
  }

  :global(.footerMobile) {
    display: none;
  }
 :global(.navd) { display: grid !important; }
  :global(.nav)  { display: none !important; }

  .hero__title {
    display: none;
  }
   .sek_to__text--desktop { display: block; }
  .sek_to__text--mobile { display: none; }
  
  .hero__meta,
  .hero__text,
  .hero__link {
    display: none;
  }
  .hero__titleDesktop {
    display: grid;
    grid-template-columns: 1fr 1fr;
    column-gap: 160px;           
    align-items: end;
    margin-top: auto;             
    margin-bottom: 0px;
    font-family: "Whyte Inktrap";
    font-size: 180px;
    line-height: 0.85;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: -0.4rem;
    color: #fbfbfb;
    transform: translateY(-10px);
  }

  .hero {
   padding-inline: 24px;
  }

  .hero__titleDesktop .t1 { justify-self: start; }
  .hero__titleDesktop .t2 { justify-self: end; }

  .hero__titleDesktop .t3 {
    grid-column: 1 / -1;
    justify-self: center;         
  }

  .heroDeskOrg {
  left: 24px;
  font-family: "Whyte";
  font-size: 24px;
  font-weight: 300;
  color: #fbfbfb;
  line-height: 1.2;
  display: block;
}
.hero {
    height: 812px;       
  }
  .hero__img,
  .hero__overlay {
    height: 100%;        
  }

.hero__line {
    margin-top: 90px;   
    padding-inline: -24px;
  }
  .hero__deskMeta {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;  
    align-items: start;
    margin-top: 18px;                   
    font-family: "Whyte";
    font-size: 24px;
    font-weight: 300;
  }

  .hero__deskLeft {
    justify-self: start;
    line-height: 1.15;
  }

  .hero__deskCenter {
    justify-self: center;
    text-align: left;
    max-width: 520px; 
  }

  .hero__deskVB {
    font-size: 15px;
    opacity: 0.85;
    margin-bottom: 10px;
  }

  .hero__deskText {
    margin: 0;
    line-height: 1.25;
    text-indent: 112px;
    margin-top: -32px;
  }

  .hero__deskKontakt {
    justify-self: end;
    text-decoration: none;
    color: inherit;
    white-space: nowrap;
  }

  .sek_to{
    height: 815px;                
    padding-inline: 24px;
    flex-direction: column;
    justify-content: flex-start;   
    border-bottom: 1px solid rgba(0,0,0,0.15);
  }

  .sek_to p{
    font-size: 72px;
    line-height: 1.02;
    max-width: 1400px;             
  }

  .sek_to img{
    width: 316px;
    height: 428px;
    object-fit: cover;
    margin-top: 120px;            
    margin-left: auto;   
    margin-right: 230px;          
    margin-bottom: 0;
  }

  .organisationen{
    height: 970px;          
    padding-inline: 24px;
    position: relative;
  }

  .organisationen__content{
    display: grid;
    grid-template-columns: 240px 120px 1fr; 
    column-gap: 80px;
    align-items: start;
    width: 100%;
  }

  .organisationen__label{
    font-size: 24px;
    margin: 0;
    font-weight: 300;
  }

  .organisationen__tag{
    display: block;
    font-family: "Whyte Mono Inktrap";
    font-size: 16px;
    opacity: 0.6;
    margin-top: 2px;
    transform: translateX(524px);
  }

  .organisationen__text{
    grid-column: 3;
    justify-self: end;
    font-size: 24px;
    line-height: 1.2;
    width: 550px;
    max-width: none;
    margin: 0;
    font-weight: 300;
  }

  
  .organisationen__cta{
    position: absolute;
    left: 24px;
    right: 24px;
    bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-top: 0; 
  }

  .organisationen__cta h2{
    font-size: 120px;
    line-height: 1;
    margin: 0;

  }

  .organisationen__cta a{
    font-size: 16px;
    font-family: "Whyte Mono Inktrap";
    white-space: nowrap;
    margin-bottom: 10px;
  }
  .organisationen__text:first-of-type{
    text-indent: 112px;
  }
   .organisationen__divider {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
  }
  .lokaleCards {
    height: auto;                
    margin-top: 0;
    padding: 0 24px 80px;
    background: #fbfbfb;
    border-bottom: none;
    margin-bottom: 120px;

    display: grid;
    grid-template-columns: 453px 454px 453px;
    column-gap: 15px;
    justify-content: center;
    align-items: start;
  }

  .lokaleCard {
    display: flex;
    flex-direction: column;
    margin: 0;                  
  }

  
  .lokaleMeta {
    margin-top: 120px;
    font-family: "Whyte Mono Inktrap";
    font-size: 16px;
    letter-spacing: 0;
    order: -1;
    margin-bottom: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    row-gap: 2px;
  }
   .lokaleLeft {
    display: flex;
    flex-direction: column;
  }

  .lokaleName,
  .lokaleCity,
  .lokalePrice {
    font-size: 16px;
    font-family: "Whyte Mono Inktrap";
    font-weight: 300;
  }

  .lokaleCity {
    order: -1;
    opacity: 0.5;
  }
  .lokalePrice {
    align-self: end;
    font-family: "Whyte Mono Inktrap";
  }

  
  .lokaleImg {
    width: 100%;
    object-fit: cover;
    display: block;
  }

 
  .lokaleCard:nth-child(1) .lokaleImg,
  .lokaleCard:nth-child(3) .lokaleImg {
    width: 453px;
    height: 624px;
  }

  
  .lokaleCard:nth-child(2) {
    transform: translateY(175px); 
  }

  .lokaleCard:nth-child(2) .lokaleImg {
    width: 454px;
    height: 449px;
  }

}

</style>
